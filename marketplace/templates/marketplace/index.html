{% extends 'base.html' %}
{% block content %}
<header class="masthead bg-market text-white text-center d-flex flex-column justify-content-center align-items-center">
    <div class="container d-flex align-items-center flex-column pt-2">
    <h1 style="text-shadow: 0px 7px 13px rgba(7,4,33, 0.8); font-size: xxx-large; font-family: 'Wendy One', sans-serif">The Marketplace</h1>
      <a href="{% url 'create_listing' %}" style="
          color: #fff;
          text-decoration: none;
          display: inline-block;
          background: rgba(0, 0, 0, 0.75);
          padding: 0.5rem 1rem;
          border-radius: 4px;
          font-weight: bold;
      ">
        Create Listing
      </a>
    </div>
  </header>  

<div class="container mt-4">
    <h3>Marketplace Listings</h3>
<form method="get">
    <label for="my-listings">
        <input type="checkbox" name="my_listings" id="my-listings" {% if request.GET.my_listings %}checked{% endif %}>
        Show my listings only
    </label>
    <p></p> <!-- These are a spacing workaround do not delete -->

    <!-- Sorting by price -->
    <label for="sort_by">Sort by Price:</label>
    <select name="sort_by" id="sort_by">
        <option value="price_asc" {% if sort_option == 'price_asc' %}selected{% endif %}>Low to High</option>
        <option value="price_desc" {% if sort_option == 'price_desc' %}selected{% endif %}>High to Low</option>
    </select>

    <button type="submit">Filter</button>
    <h3></h3><!-- These are a spacing workaround do not delete -->
</form>

   <!-- Display Listings -->
   {% for listing in page_obj %}
    <div class="listing">
        <h4>{{ listing.seller.user.username }}</h4>
        <p>{{ listing.user_pokemon.pokemon.name }}</p>
        <img src="{{ listing.user_pokemon.pokemon.image_url }}" alt="{{ listing.user_pokemon.pokemon.name }}">
        <p>Price: ${{ listing.price }}</p>
        <a href="{% url 'listing_detail' listing.id %}" class="btn btn-primary">View Details</a>

        <!-- Show edit button only for the listing's seller -->
        {% if listing.seller.user == user %}
            <a href="{% url 'edit_listing' listing.id %}" class="btn btn-warning">Edit Listing</a>
        {% endif %}
    </div>
{% empty %}
    <p>No listings available.</p>
{% endfor %}

    <!-- Pagination controls -->
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if request.GET.my_listings %}&my_listings=true{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.my_listings %}&my_listings=true{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.my_listings %}&my_listings=true{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.my_listings %}&my_listings=true{% endif %}{% if request.GET.sort_by %}&sort_by={{ request.GET.sort_by }}{% endif %}">last &raquo;</a>
            {% endif %}
        </span>
    </div>

</div>

{% endblock content %}